# `@asgardeo/nextjs` Quickstart

This guide will help you quickly integrate Asgardeo authentication into your Next.js application using Auth.js.

## Prerequisites

- [Node.js](https://nodejs.org/en/download) (version 18 or later. LTS version recommended)
- An [Asgardeo account](https://wso2.com/asgardeo/docs/get-started/create-asgardeo-account/)
- About 15 minutes

## Step 1: Configure an Application in Asgardeo

1. **Sign in to Asgardeo Console**
   - Go to [Asgardeo Console](https://console.asgardeo.io/)
   - Sign in with your Asgardeo account

2. **Create a New Application**
   - Click **Applications** in the left sidebar
   - Click **+ New Application**
   - Choose **Traditional Web Application**
   - Enter your application name (e.g., "Teamspace")

3. **Note Down Your Credentials from the `Quickstart` tab**
   - From the **Protocol** tab:
     - Copy the **Client ID**
     - Copy the **Client Secret**
   - From the **Info** tab:
     - Copy the **Issuer URL**

4. **Configure Application Settings from the `Protocol` tab**
   - **Authorized redirect URLs**: Add your callback URL
     - `http://localhost:3000`
   - Click **Update** to save the configuration

## Step 2: Create a Next.js Application

If you don't have a Next.js application set up yet, you can create one:

```bash
# Using npm
npm create next-app@latest next-sample -- --yes
cd next-sample

# Using pnpm
pnpm create next-app@latest next-sample -- --yes
cd next-sample

# Using yarn
yarn create next-app next-sample -- --yes
cd next-sample
```

## Step 3: Install the SDK

Install the Asgardeo Next.js SDK in your project:

```bash
# Using npm
npm install @asgardeo/nextjs

# Using pnpm
pnpm add @asgardeo/nextjs

# Using yarn
yarn add @asgardeo/nextjs
```

## Step 4: Setup Environment Variables

Create a `.env` file in your project root and add the following environment variables. Replace the placeholders with the values you copied from Asgardeo in Step 1.

**.env**

```bash
NEXT_PUBLIC_ASGARDEO_BASE_URL="https://api.asgardeo.io/t/<your-organization-name>"
NEXT_PUBLIC_ASGARDEO_CLIENT_ID="<your-app-client-id>"
ASGARDEO_CLIENT_SECRET="<your-app-client-secret>"
```

## Step 5: Setup the Middleware

Create a `middleware.ts` file in your project root to handle authentication:

```bash
import { AsgardeoNext } from '@asgardeo/nextjs';
import { NextRequest } from 'next/server';

const asgardeo = new AsgardeoNext();

asgardeo.initialize({
  baseUrl: process.env.NEXT_PUBLIC_ASGARDEO_BASE_URL,
  clientId: process.env.NEXT_PUBLIC_ASGARDEO_CLIENT_ID,
  clientSecret: process.env.ASGARDEO_CLIENT_SECRET,
});

export async function middleware(request: NextRequest) {
  return await asgardeo.middleware(request);
}

export const config = {
  matcher: [
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
};
```

## Step 6: Configure the Provider

Wrap your application with the `AsgardeoProvider` in your main entry file i.e. `app/layout.tsx`:

```tsx
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import {AsgardeoProvider} from '@asgardeo/nextjs';
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        <AsgardeoProvider>{children}</AsgardeoProvider>
      </body>
    </html>
  );
}
```

## Step 7: Add Sign-in & Sign-out to Your App

Update your `app/page.tsx` to include sign-in and sign-out functionality:

```tsx
import {SignInButton, SignedIn, SignOutButton, SignedOut} from '@asgardeo/nextjs';

export default function Home() {
  return (
    <>
      <SignedOut>
        <SignInButton />
      </SignedOut>
      <SignedIn>
        <SignOutButton />
      </SignedIn>
    </>
  );
}
```

## Step 8: Display User Information

You can also display user information by using the `User` component & the `UserProfile` component:

```tsx
import { SignedIn, SignedOut, SignInButton, SignOutButton, User, UserProfile } from '@asgardeo/nextjs';

export default function Home() {
  return (
    <>
      <SignedIn>
        <User>
          {({ user }) => (
            <div>
              <h1>Welcome, {user.username}</h1>
            </div>
          )}
        </User>
        <UserProfile />
        <SignOutButton />
      </SignedIn>
      <SignedOut>
        <SignInButton />
      </SignedOut>
    </>
  );
}
```

## Step 9: Try Login

Run your application and test the sign-in functionality. You should see a "Sign In" button when you're not signed in, and clicking it will redirect you to the Asgardeo sign-in page.

```bash
# Using npm
npm run dev

# Using pnpm
pnpm dev

# Using yarn
yarn dev
```

## Step 10: Embedded Login Page (Optional)

If you want to use an embedded login page instead of redirecting to Asgardeo, you can use the `SignIn` component:

Configure the path of the sign-in page in the `middleware.ts` file:

```diff
import { AsgardeoNext } from '@asgardeo/nextjs';
import { NextRequest } from 'next/server';

const asgardeo = new AsgardeoNext();

asgardeo.initialize({
  baseUrl: process.env.NEXT_PUBLIC_ASGARDEO_BASE_URL,
  clientId: process.env.NEXT_PUBLIC_ASGARDEO_CLIENT_ID,
  clientSecret: process.env.ASGARDEO_CLIENT_SECRET,
+  signInUrl: '/signin',
});

export async function middleware(request: NextRequest) {
  return await asgardeo.middleware(request);
}

export const config = {
  matcher: [
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
};
```

Then, create a new page for the sign-in component in `app/signin/page.tsx`:

```tsx
'use client';

import {SignIn} from '@asgardeo/nextjs';

export default function SignInPage() {
  return <SignIn />;
}
```

Once you have set this up, clicking on the "Sign In" button will render the embedded login page instead of redirecting to Asgardeo.

## Next Steps

ðŸŽ‰ **Congratulations!** You've successfully integrated Asgardeo authentication into your Next.js app.

### What to explore next:

- **User Profile Management** - Access and display detailed user profile information
- **Protected Routes** - Implement route-level authentication using middleware
- **Custom Styling** - Customize the appearance of your authentication flow
- **Session Management** - Learn about managing user sessions and tokens
- **Error Handling** - Implement proper error handling for authentication flows

### Common Issues

- **Redirect URL Mismatch**: Ensure your redirect URL in Asgardeo matches exactly: `http://localhost:3000`
- **Environment Variables**: Double-check that all environment variables are correctly set in `.env`

### Additional Resources

- **[Auth.js Documentation](https://authjs.dev/)** - Learn more about Auth.js features and configuration
- **[Asgardeo Documentation](https://wso2.com/asgardeo/docs/)** - Comprehensive guide to Asgardeo features
- **[Next.js Documentation](https://nextjs.org/docs)** - Learn more about Next.js features and best practices

For more help, visit the [Asgardeo Documentation](https://wso2.com/asgardeo/docs/) or check out our [examples](../../examples/).
